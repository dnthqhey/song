<!DOCTYPE html>
<html lang="ko">
<head>
    <!--meta http-equiv="refresh" content="30" /-->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=2.0, minimum-scale=1.0, user-scalable=yes" />
    <meta name="keywords" content="성동구 새소식" />
    <meta name="description" content="성동구 새소식" />
    <link rel="stylesheet" type="text/css" href="/common/css/font.css" />
    <link rel="stylesheet" type="text/css" href="/site/kiosk/css/main_test.css" />
    <!--[if lt IE 9]><script src="/common/js/html5.js"></script><![endif]-->
    <script src="/common/js/jquery-1.12.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
    <script src="/common/js/plugins.js"></script>
    <script src="/common/js/program.min.js"></script>
    <script src="/site/kiosk/js/main.js"></script>
    <script type="text/javascript">
        <!--
        /* 서버 시간 참조 */
        var xmlHttp;
        function srvTime() {
            try {
                //FF, Opera, Safari, Chrome
                xmlHttp = new XMLHttpRequest();
            }
            catch (err1) {
                //IE
                try {
                    xmlHttp = new ActiveXObject('Msxml2.XMLHTTP');
                }
                catch (err2) {
                    try {
                        xmlHttp = new ActiveXObject('Microsoft.XMLHTTP');
                    }
                    catch (eerr3) {
                        //AJAX not supported, use CPU time.
                        console.log("AJAX not supported");
                    }
                }
            }
            xmlHttp.open('HEAD', window.location.href.toString(), false);
            xmlHttp.setRequestHeader("Content-Type", "text/html");
            xmlHttp.send('');
            return xmlHttp.getResponseHeader("Date");
        }

        var st = srvTime();
        var serverDate = new Date(st);
        //-->
    </script>
    <script language="javascript">
        //var localTime = new Date();
        //document.write("Local machine time is: " + localTime + "<br>");
        // console.log("Server time is: " + serverDate);
    </script>
    <script>
        var site = {
            id : 'site',
            layout : 'www',
            login : 'true'
        };
    </script>
    <script src="/common/js/layout.js"></script>
    <title>성동구 선별진료소 실시간 대기현황</title>
</head>
<body class="kiosk6">
<script>

    var idleTime = 0;
    $(document).ready(function() {
        var idleInterval = setInterval(timerIncrement, 20000);
        //1000 =  1초

        if(element.requestFullScreen) {
            element.requestFullScreen();
        } else if(element.webkitRequestFullScreen ) {
            element.webkitRequestFullScreen();
        } else if(element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen(); // IE
        }
    });
    $(function() {
        $('#refresh_btn').on('click', function() {
            location.reload(true);
        });
    });
    function InfoRefresh(){
        location.reload(true);
    }
    function timerIncrement(){
        var timeLimit = 5;
        idleTime = idleTime + 1;
        console.log(idleTime);
        if (idleTime > timeLimit ) { // 5 minutes
            readCvdWait();
            readCvcWait();
            //readCvbWait();
        }
    }
    function readCvbWait(){
        /* 2022-05-10 부터 성동구 구두 테마공원 대기사항 표시 삭제 */
        console.log("성수구두테마공원 대기정보갱신");
        /* 성수구두테마공원) */
        var now = serverDate;//new Date();
        var day=now.getDay();//요일

        /* Tue Aug 17 2021 09:05:42 GMT+0900 을 YYYY-MM-dd 형식으로 변경*/
        var year = now.getFullYear();
        var month = ('0' + (now.getMonth() + 1)).slice(-2);
        var dd = ('0' + now.getDate()).slice(-2);

        var dateString = year + '-' + month  + '-' + dd;

        /*
        0:일,1:월,2:화,3:수,4:목,5:금,6:토
        */
        var hr=now.getHours();//시간
        var min=now.getMinutes();//분
        var msgText="";
        if(day==0 || day==6 ){
            msgText ="금일 휴무";
        }else{
            //평일은 17시까지
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=17){
                msgText ="금일운영종료";
            }
        }
        // 구두공원 임시 강제 설정
        //msgText = "점검중";

        /* 시간대에 따른 대기시간 표시 */
        var watingStatus="";
        if(hr>=9 && hr<13){
            watingStatus = "대기시간 30분 소요예상";
        }else if (hr>=13 && hr<=14){
            watingStatus = "대기시간 30분 소요예상";
        }else if (hr>14 && hr<17){
            watingStatus = "대기시간 30분 소요예상";
        }else{
            watingStatus = "대기자 없음";
        }
        watingStatus = "대기자 없음";

        if(day==0 || day==6 ){
            //토요일은 휴무
            watingStatus = "대기자 없음";
        }

        //대체공휴일 입력구간
        var vFlag="N";
        var dateTime=now.toISOString();
        var toDay=dateTime.substring(0,10);
		//var alternativeHolidays = ["2022-03-01","2022-03-09","2022-05-05","2022-06-01","2022-06-06","2022-08-15","2022-09-09","2022-09-12","2022-10-03","2022-10-10"];
		/*2023년 대체공휴일*/
		var alternativeHolidays = ["2023-01-21","2023-01-23","2023-01-24"];
//console.log(now.toISOString());
//console.log(dateString);
//console.log(toDay);
        /*
            서버시간이 현재시간과 다를 경우 공휴일이 지나도 인식을 하지 않음
        */
        for(var i=0; i<alternativeHolidays.length ; i++){
            //if(toDay ===alternativeHolidays[i]) vFlag="Y";
            if(dateString ===alternativeHolidays[i]) vFlag="Y";
        }
        //msgText ="금일 휴무";		//임시 강제 설정
        //대체공휴일 운영 안 할 경우
        if(vFlag=="Y") msgText ="금일 휴무";

        var cDay ="2022-04-29"; /* 중단개시일*/
        var isClose ="N";
        //console.log(cDay);
        //console.log(dateString);
        if(dateString>=cDay){
            //console.log("운영중단");
            msgText ="운영중단";
            isClose  = "Y";
        }
        //console.log("isClose"+isClose);

        $.ajax({
            url:'/readCvibWaitGroupSetJSON.do',
            type: 'POST',
            dataType: 'json',
            cache: false,
            async: true,
            success: function(resp) {

                if(resp.groupList.length == 1) {
                    if (msgText!=""){
                        //$('#stat3').html('<em>'+msgText+'</em>');
                        $('#cvid_seq_3_waitNo').text(msgText);
                        $('#cvid_seq_update3_today').text(resp.today);
                        $('#cvid_seq_update3_time').text(resp.thisTime.substr(0,5));
                    }else{
                        $('#cvid_seq_update3_today').text(resp.today);
                        $('#cvid_seq_update3_time').text(resp.thisTime.substr(0,5));
                        $('#cvid_seq_3_waitNo').text(resp.groupList[0].waitNo).append('명');
                        $('#cvid_seq_3_lastCallNo').text(resp.groupList[0].lastCallNo);
                    }
                    //$('#watingTx2').text(watingStatus);
                    if(isClose =="Y"){
                        $('#cvid_seq_update3_today').text("");
                        //$('#call_text3').text(" ");
                        $('#cvid_seq_update3_time').text("");
                        $('#cvid_seq_3_waitNo').text(msgText);
                        $('#cvid_seq_3_lastCallNo').text("");


                        $('#screening_center_day3').css("display","none");
                        //$('#call_text3').css("display","none");
                        $('#waiting_box3').css("display","none");
                        $('#time_area3').css("display","none");
                        $('#end_time3').css("display","none");
                    }

                }
            }
        });
    }
    function readCvcWait(){
        //console.log("성동구청 농구장 대기정보갱신");
        /* 성동구청 농구장 */
        var now = serverDate;//new Date();
        var day=now.getDay();//요일
        /* Tue Aug 17 2021 09:05:42 GMT+0900 을 YYYY-MM-dd 형식으로 변경*/
        var year = now.getFullYear();
        var month = ('0' + (now.getMonth() + 1)).slice(-2);
        var dd = ('0' + now.getDate()).slice(-2);

        var dateString = year + '-' + month  + '-' + dd;

        /*
        0:일,1:월,2:화,3:수,4:목,5:금,6:토
        */

        var hr=now.getHours();//시간
        var min=now.getMinutes();//분
        var msgText="";

        /* 당분간 일요일도 운영 (농구장)
        if(day==0){
            msgText ="일요일 휴무";
        }else if(day==6 ){
        */

        //대체공휴일 입력구간 (농구장)
        var vFlag="N";
        var dateTime=now.toISOString();
        var toDay=dateTime.substring(0,10);
        //var alternativeHolidays = ["2022-03-01","2022-03-09","2022-05-05","2022-06-01","2022-06-06","2022-08-15","2022-09-09","2022-09-12","2022-10-03","2022-10-10"];
		/*2023년 대체공휴일*/
		var alternativeHolidays = ["2023-01-21","2023-01-23","2023-01-24"];
        //console.log(now.toISOString());
        for(var i=0; i<alternativeHolidays.length ; i++){
            //if(toDay ===alternativeHolidays[i]) vFlag="Y";
            if(dateString ===alternativeHolidays[i]) vFlag="Y";
        }

        if(day==0){
            //일요일은 18 시까지
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=18){
                msgText ="금일운영종료";
            } else if (hr>=13 && hr<14) {
                msgText ="소독시간(13시~14시)";
            } /* else { 	msgText ="접수마감";	}  */  //임시(농구장) 일요일 대기자가 많아
        }else if(day==6){
            //토요일은 휴무
            msgText ="금일 휴무";
        }else{
            //평일은 17->21 까지
            if(hr < 13 ){
                msgText ="준비중(13시)";
            } else if(hr>=21){
                msgText ="금일운영종료";
            } else if (hr>=17 && hr<18) {
                msgText ="소독시간(17시~18시)";
            }
        }

        if(vFlag=="Y") {
            msgText ="";
			/*
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=18){
                msgText ="금일운영종료";
            }*/
			 msgText ="금일 휴무";
        }

        //msgText ="접수마감";		//임시 강제 설정 (농구장)

        /*
        시간대에 따라 소요시간 안내 출력
        9시~13시 :30분
        13시~15시:15분
        15시~17시:대기자없음
        */
        var watingStatus="";
        if(hr>=9 && hr<13){
            //watingStatus = "대기시간 30분 소요예상";
            //watingStatus = "대기시간 1시간 소요예상";
            watingStatus = "대기시간 10분 소요예상";
        }else if (hr>=13 && hr<=14){
            //watingStatus = "대기시간 15분 소요예상";
            //watingStatus = "대기시간 1시간 소요예상";
            watingStatus = "대기시간 10분 소요예상";
            //}else if (hr>14 && hr<17){
            //	watingStatus = "대기시간 1시간 소요예상";
        }else{
            watingStatus = "대기자 없음";
        }
        //watingStatus = "대기자 없음";

        if(day==6){
            //토요일은 휴무
            watingStatus = "대기자 없음";
        }

		/* 2022-07-25 부터 운영재개*/
        /*
		var cDay ="2022-06-13";  중단개시일
        var isClose ="N";
        //console.log(cDay);
        //console.log(dateString);
        if(dateString>=cDay){
            //console.log("운영중단");
            msgText ="운영중단";
            isClose  = "N"; 
        }*/
		//var isClose ="Y";
		//msgText ="점검중";

		/*
		2022-09-05 
		태풍 관련하여 임시선별진료소 운영시간 임시 변경
		9.5.(월) 13시~18시 (단축운영)
		9.6.(화) 미운영
		*/
		if (dateString=="2022-09-05"){
				if(hr < 13 ){
					msgText ="준비중(13시)";
				} else if(hr>=18){
					msgText ="금일운영종료";
				} 
		}		
		if (dateString=="2022-09-06"){
			msgText ="미운영";
		}
        $.ajax({
            url:'/readCvicWaitGroupSetJSON.do',
            type: 'POST',
            dataType: 'json',
            cache: false,
            async: true,
            success: function(resp) {
				console.log(resp);
					if(resp.result == "exception"){
								$('#cvid_seq_update2_today').text("");
								//$('#call_text3').text(" ");
								$('#cvid_seq_update2_time').text("");
								$('#cvid_seq_2_waitNo').text("점검중");
								$('#cvid_seq_2_lastCallNo').text("");


								$('#screening_center_day2').css("display","none");
								//$('#call_text3').css("display","none");
								$('#waiting_box2').css("display","none");
								$('#time_area2').css("display","none");
								$('#end_time2').css("display","none");
					}else{

						if(resp.groupList.length == 1) {
							if (msgText!=""){
								//$('#stat2').html('<em>'+msgText+'</em>');
								$('#cvid_seq_2_waitNo').text(msgText);
								$('#cvid_seq_update2_today').text(resp.today);
								$('#cvid_seq_update2_time').text(resp.thisTime.substr(0,5));
							}else{
								$('#cvid_seq_update2_today').text(resp.today);
								$('#cvid_seq_update2_time').text(resp.thisTime.substr(0,5));
								$('#cvid_seq_2_waitNo').text(resp.groupList[0].waitNo).append('명');
								$('#cvid_seq_2_lastCallNo').text(resp.groupList[0].lastCallNo);
							}
							//$('#watingTx').text(watingStatus);
							if(isClose =="Y"){
								$('#cvid_seq_update2_today').text("");
								//$('#call_text3').text(" ");
								$('#cvid_seq_update2_time').text("");
								$('#cvid_seq_2_waitNo').text(msgText);
								$('#cvid_seq_2_lastCallNo').text("");


								$('#screening_center_day2').css("display","none");
								//$('#call_text3').css("display","none");
								$('#waiting_box2').css("display","none");
								$('#time_area2').css("display","none");
								$('#end_time2').css("display","none");
							}
						}
					}		
            }
        });
    }
    function readCvdWait(){
        //console.log("성동구 보건소 대기정보갱신");
        /* 성동구 보건소 */
        var now = serverDate;//new Date();
        var day=now.getDay();//요일

        /* Tue Aug 17 2021 09:05:42 GMT+0900 을 YYYY-MM-dd 형식으로 변경*/
        var year = now.getFullYear();
        var month = ('0' + (now.getMonth() + 1)).slice(-2);
        var dd = ('0' + now.getDate()).slice(-2);

        var dateString = year + '-' + month  + '-' + dd;

        /*
        0:일,1:월,2:화,3:수,4:목,5:금,6:토
        */
        var hr=now.getHours();//시간
        var min=now.getMinutes();//분
        var msgText="";

        //대체공휴일 입력구간 (보건소)
        var vFlag="N";
        var dateTime=now.toISOString();
        var toDay=dateTime.substring(0,10);
        console.log(now.toISOString());
        //var alternativeHolidays = ["2022-03-01","2022-03-09","2022-05-05","2022-06-01","2022-06-06","2022-08-15","2022-09-09","2022-09-12","2022-10-03","2022-10-10"];
		/*2023년 대체공휴일*/
		var alternativeHolidays = ["2023-01-21","2023-01-23","2023-01-24"];
        for(var i=0; i<alternativeHolidays.length ; i++){
            //if(toDay ===alternativeHolidays[i]) vFlag="Y";
            if(dateString ===alternativeHolidays[i]) vFlag="Y";
        }


        if(day==6 ){
            //토요일 18시까지(2.24일부터 13시까지로 변경)
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=18){
                msgText ="금일운영종료";
            } else if (hr>=13 && hr<14) {
                msgText ="소독시간(13시~14시)";
            } /*else {	msgText="접수마감"; }*/  // 임시(보건소) -> 대기자 많아 강제 접수마감 처리
        }else if(day==0){
            //일요일은 휴무
            msgText ="금일 휴무";
        }else{
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=18){
                msgText ="금일운영종료";
            } else if (hr>=13 && hr<14) {
                msgText ="소독시간(13시~14시)";
            }
        }

        /** 24 일 이후에 적용*/
        if(vFlag=="Y" ){
            //공휴일은 2.24일부터 18시까지
            msgText="";
            if(hr < 9 ){
                msgText ="준비중(9시)";
            } else if(hr>=18){
                msgText ="금일운영종료";
            } else if (hr>=13 && hr<14) {
                //msgText ="중식시간(1시~2시)";
                msgText ="소독시간(13시~14시)";
            }
        }

        //msgText ="금일운영종료";
		/* 2022-09-06  추석연휴  운영시간 수동 설정 */
		if ((dateString=="2022-09-09") || (dateString=="2022-09-10") || (dateString=="2022-09-12")){
			if(hr < 9 ){
				msgText ="준비중(9시)";
			} else if(hr>=18){
				msgText ="금일운영종료";
			} else if (hr>=13 && hr<14) {
				msgText ="소독시간(13시~14시)";
			}  /*else { msgText ="대기자가 많아 접수마감";	} */  
		}

        $.ajax({
            url:'/readCvidWaitGroupSetJSON.do',
            type: 'POST',
            dataType: 'json',
            cache: false,
            async: true,
            success: function(resp) {
				if(resp.result == "exception"){
					$('#cvid_seq_update1_today').text("");
					//$('#call_text3').text(" ");
					$('#cvid_seq_update1_time').text("");
					$('#cvid_seq_1_waitNo').text("점검중");
					$('#cvid_seq_1_lastCallNo').text("");


					$('#screening_center_day1').css("display","none");
					//$('#call_text3').css("display","none");
					$('#waiting_box1').css("display","none");
					$('#time_area1').css("display","none");
					$('#end_time1').css("display","none");
				}else{
					if(resp.groupList.length == 1) {
						if (msgText!=""){
							//$('#stat1').html('<em>'+msgText+'</em>');
							$('#cvid_seq_1_waitNo').text(msgText);
							$('#cvid_seq_update1_today').text(resp.today);
							//$('#cvid_seq_update1_time').text(resp.thisTime);
							$('#cvid_seq_update1_time').text(resp.thisTime.substr(0,5));
						}else{
							$('#cvid_seq_update1_today').text(resp.today);
							//$('#cvid_seq_update1_time').text(resp.thisTime);
							$('#cvid_seq_update1_time').text(resp.thisTime.substr(0,5));
							$('#cvid_seq_1_waitNo').text(resp.groupList[0].waitNo).append('명');
							$('#cvid_seq_1_lastCallNo').text(resp.groupList[0].lastCallNo);
						}				
					}
                }
            }
        });
    }
    readCvdWait();
    readCvcWait();/* 성동구청 농구장 임시 선별검사소*/
    //readCvbWait();
</script>
<div id="wrapper">
    <div class="kiosk_wrap">
        <a href="javascript:InfoRefresh();" class="refresh_btn" id="refresh_btn"><span>새로고침</span></a>
        <h1><span>선별진료소(PCR)</span> 실시간 대기현황</h1>
        <p class="title_text">※ 선별진료소 방문 전 전자문진표 사전작성이 가능합니다.</p>
        <div class="cont_area clearfix">
            <!--cont_box-->
            <div class="cont_box n1">
                <div class="title">
                    <ul class="screening_center_day clearfix">
                        <li>평일·토요일·공휴일 09~18시</li>
                        <li>일요일 <span class="em_red">휴무</span></li>
                    </ul>
                    <h2>성동구보건소<br />
                        선별진료소</h2>
                    <a href="https://covid19m.kdca.go.kr/phc/11700092" target="_blank" title="새창열림" class="write_btn">PCR 전자문진표 작성</a>
                </div>
                <div class="content">
                    <div class="inner">
                        <p class="call_text">대기인수</p>
                        <p class="call_num" id="stat1"><span id="cvid_seq_1_waitNo"></span></p>
                    </div>
                    <p class="waiting_box">
                        호출번호 <span id="cvid_seq_1_lastCallNo">00</span>번
                    </p>

                    <ul class="time_area">
                        <li><span id="cvid_seq_update1_today">2021-07-16</span></li>
                        <li><span id="cvid_seq_update1_time">00:00</span> 현재</li>
                    </ul>
                    <div class="end_time">
                        <h3>접수<br />마감</h3>
                        <div class="cont">
                            <ul>
                                <li><strong>평일, 토요일, 공휴일:</strong> 오전 12:30/소독시간13~14시/오후 17:30</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--cont_box-->
            <!--cont_box-->
            <div class="cont_box n2">
                <div class="title">
                    <ul class="screening_center_day clearfix">
                        <li>평일 13~21시</li>
                        <li>일요일 09~18시</li>
                        <li>토요일, 공휴일 <span class="em_red">휴무</span></li>
                    </ul>
                    <h2>성동구청(농구장)<br />
                        임시선별검사소</h2>
                    <a href="https://covid19m.kdca.go.kr/KP/117000921A" target="_blank" title="새창열림" class="write_btn">PCR 전자문진표 작성</a>
                </div>
                <div class="content">
                    <div class="inner">
                        <p class="call_text">대기인수</p>
                        <p class="call_num" id="stat2"><span id="cvid_seq_2_waitNo"></span></p>
                    </div>
                    <p class="waiting_box" >
                        호출번호 <span id="cvid_seq_2_lastCallNo">00</span>번
                    </p>

                    <ul class="time_area">
                        <li><span id="cvid_seq_update2_today">2022-07-25</span></li>
                        <li><span id="cvid_seq_update2_time">00:00</span> 현재</li>
                    </ul>
                    <div class="end_time">
                        <!--h3>접수<br />마감</h3-->
                        <div class="cont">
                            <ul>
                                <li><strong>평일:</strong> 소독시간 17~18시</li>
                                <li><strong>일요일:</strong> 소독시간 13~14시</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--cont_box-->

        </div>
        <!--<ul class="time_area">
            <li><span id="cvid_seq_update_today">2021-07-14</span></li>
            <li><span id="cvid_seq_update_time">00:00</span> 현재</li>
        </ul>-->
    </div>
</div>
</body>
</html>