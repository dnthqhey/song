<%@ page language="java" pageEncoding="UTF-8"%><%
	request.setAttribute("IP_CHECKER_LOADED", "Y");
	String _remoteIp = kr.co.hanshinit.NeoCMS.cmm.util.HtmlUtil.getRemoteAddr(request);
	request.setAttribute("REMOTE_ADDR_IS_IN_SCHOOL", testIpInRange(_remoteIp)?"Y":"N");
%><%!
boolean testIpInRange(String ip) {
	long[][] IP_RANGE_L = new long[][] {
		/*127.0.0.0	~	127.0.0.255*/	{2130706432L, 2130706687L},
		/*175.212.21.90	~	175.212.21.90*/	{2949911898L, 2949911898L},
		/*192.168.0.0	~	192.168.0.255*/	{3232235520L, 3232235775L},
		/*192.203.144.0	~	192.203.144.255*/	{3234566144L, 3234566399L},
		/*203.252.64.0	~	203.252.95.255*/	{3422306304L, 3422314495L},
		/*210.113.32.0	~	210.113.63.255*/	{3530629120L, 3530637311L},
		/*114.70.224.0	~	114.70.239.255*/	{1917247488L, 1917251583L},
		/*220.149.44.0	~	220.149.47.255*/	{3700763648L, 3700764671L},
		/*210.107.93.0	~	210.107.93.255*/	{3530251520L, 3530251775L},
		/*210.120.85.0	~	210.120.85.255*/	{3531101440L, 3531101695L},
		/*210.182.254.0	~	210.182.254.255*/	{3535207936L, 3535208191L},
		/*210.206.221.0	~	210.206.221.255*/	{3536772352L, 3536772607L},
		/*210.207.253.0	~	210.207.253.255*/	{3536846080L, 3536846335L},
		/*211.118.144.0	~	211.118.144.255*/	{3547762688L, 3547762943L},
		/*211.119.253.0	~	211.119.253.255*/	{3547856128L, 3547856383L},
		/*211.168.248.0	~	211.168.248.255*/	{3551066112L, 3551066367L},
		/*211.168.58.0	~	211.168.58.255*/	{3551017472L, 3551017727L},
		/*211.170.247.0	~	211.170.247.255*/	{3551196928L, 3551197183L},
		/*211.180.61.0	~	211.180.61.255*/	{3551804672L, 3551804927L},
		/*211.181.192.0	~	211.181.192.255*/	{3551903744L, 3551903999L},
		/*211.234.21.0	~	211.234.21.255*/	{3555333376L, 3555333631L},
		/*211.40.239.0	~	211.40.239.255*/	{3542675200L, 3542675455L},
		/*211.60.141.0	~	211.60.141.255*/	{3543960832L, 3543961087L},
		/*121.187.64.0	~	121.187.79.255*/	{2042314752L, 2042318847L},
		/*121.187.80.0	~	121.187.83.255*/	{2042318848L, 2042319871L},
		/*121.187.84.0	~	121.187.85.255*/	{2042319872L, 2042320383L},
		/*114.70.100.0	~	114.70.103.255*/	{1917215744L, 1917216767L},
		/*114.70.104.0	~	114.70.111.255*/	{1917216768L, 1917218815L},
		/*114.70.112.0	~	114.70.119.255*/	{1917218816L, 1917220863L},
		/*114.70.120.0	~	114.70.123.255*/	{1917220864L, 1917221887L},
		/*211.52.221.0	~	211.52.221.255*/	{3543457024L, 3543457279L},
		/*114.70.124.0	~	114.70.125.255*/	{1917221888L, 1917222399L},
		/*114.70.74.0	~	114.70.75.255*/	{1917209088L, 1917209599L},
		/*114.70.98.0	~	114.70.99.255*/	{1917215232L, 1917215743L},
		/*114.70.218.0	~	114.70.219.255*/	{1917245952L, 1917246463L},
		/*117.17.114.0	~	117.17.115.255*/	{1964077568L, 1964078079L},
		/*210.115.32.1	~	210.115.63.255*/	{3530760193L, 3530768383L},
		/*211.53.221.1	~	211.53.221.255*/	{3543522561L, 3543522815L},
		/*211.168.247.1	~	211.168.247.255*/	{3551065857L, 3551066111L},
		/*211.169.58.1	~	211.169.58.255*/	{3551083009L, 3551083263L},
		/*210.115.40.1	~	210.115.40.255*/	{3530762241L, 3530762495L},

		/*211.218.176.1	~	211.218.176.255*/	{3554324481L, 3554324735L},
		/*121.158.158.128	~	121.158.158.255*/	{2040438400L, 2040438527L}
	};

	/**
	long ipl = ipToLong(ip);
	boolean in_range = false;
	for(int i=0, n=IP_RANGE_L.length; i < n; i++) {
		long in = IP_RANGE_L[i][0];
		long to = IP_RANGE_L[i][1];

		if(in <= ipl && ipl <= to) {

			in_range = true; break;
		}
	}

	if(in_range) {
		System.out.println(ip + "-ok");
	}
	else {
		System.out.println(ip + "-denied");
	}

	return in_range;
	/*/
	return true;
	/**/
}

long ipToLong(String ipAddress) {
	long result = 0;
	String[] ipAddressInArray = ipAddress.split("\\.");
	for (int i = 3; i >= 0; i--) {
		long ip = Long.parseLong(ipAddressInArray[3 - i]);
		result |= ip << (i * 8);
	}
	return result;
}
%>